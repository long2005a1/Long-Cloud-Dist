import{aA as _,a as z,a$ as S,bg as b,r as f,i as t,ay as M,b1 as ee,bT as ne,S as m,aE as Z,cl as We,cm as je,a9 as L,bU as $e,d9 as ye,G as y,bh as A,n as te,ae as re,aa as G,d1 as Ue,da as F,L as xe,db as Ve,cj as ke,q as R,j as He,z as Ke,D as qe,K as D,w as Qe,cL as Xe,b as Je,N as Ye,aQ as W,cO as pe,dc as _e,dd as Ze,aF as ve}from"./index.93bedee9.js";import{P as Ee}from"./Paginator.1e48ab3f.js";var T;(function(e){e[e.Pending=0]="Pending",e[e.Running=1]="Running",e[e.Succeeded=2]="Succeeded",e[e.Canceling=3]="Canceling",e[e.Canceled=4]="Canceled",e[e.Errored=5]="Errored",e[e.Failing=6]="Failing",e[e.Failed=7]="Failed",e[e.WaitingRetry=8]="WaitingRetry",e[e.BeforeRetry=9]="BeforeRetry"})(T||(T={}));const et={[T.Failed]:"danger",[T.Succeeded]:"success",[T.Canceled]:"neutral"},tt=e=>{if(e.role<0)return null;const n=["info","neutral","accent"];return t(ke,{get colorScheme(){return n[e.role]},css:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},get children(){return e.name}})},rt=e=>{const n=z();return t(ke,{get colorScheme(){var s;return(s=et[e.state])!=null?s:"info"},get children(){return n(`tasks.state.${e.state}`)}})},l=[{name:"name",textAlign:"left",w:_().role===2?"calc(100% - 660px)":"calc(100% - 560px)"},{name:"creator",textAlign:"center",w:_().role===2?"100px":"0"},{name:"state",textAlign:"center",w:"100px"},{name:"progress",textAlign:"left",w:"140px"},{name:"speed",textAlign:"center",w:"100px"},{name:"operation",textAlign:"right",w:"220px"}],E=e=>Math.floor(e).toString().padStart(2,"0"),nt=e=>{const n=e/1e3%60,s=e/1e3/60%60,i=e/1e3/3600;return`${E(i)}:${E(s)}:${E(n)}`},at=e=>{const n=z(),s=e.done==="undone"?"cancel":"delete",i=e.done==="done"&&(e.state===T.Failed||e.state===T.Canceled),[d,u]=S(()=>b.post(`/task/${e.type}/${s}?tid=${e.id}`)),[v,x]=S(()=>b.post(`/task/${e.type}/retry?tid=${e.id}`)),[B,g]=f(!1),k=e.name.match(e.nameAnalyzer.regex),K=k===null?e.name:e.nameAnalyzer.title(k),h=e.start_time===null?-1:new Date(e.start_time).getTime(),j=e.end_time===null?new Date().getTime():new Date(e.end_time).getTime();let I="-";const U=(c,w)=>{let p=w/c,P="bytes/s";return p>1024&&(p/=1024,P="KB/s"),p>1024&&(p/=1024,P="MB/s"),p>1024&&(p/=1024,P="GB/s"),`${p.toFixed(2)} ${P}`};if(e.done){if(e.start_time!==e.end_time&&e.progress>0&&h!==-1){const c=(j-h)/1e3,w=e.total_bytes*e.progress/100;I=U(c,w)}}else if(e.prevProgress!==void 0&&e.prevFetchTime!==void 0){const c=(e.curFetchTime-e.prevFetchTime)/1e3,w=(e.progress-e.prevProgress)*e.total_bytes/100;I=U(c,w)}return t(m,{get when(){return!B()},get children(){return[t(M,{w:"$full",p:"$2",get children(){return[t(M,{get w(){return l[0].w},spacing:"$1",get children(){return[t(ee,{"on:click":c=>{c.stopPropagation()},get checked(){return e.local.selected},onChange:c=>{e.setLocal({selected:c.target.checked,expanded:e.local.expanded})}}),t(ne,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:K})]}}),t(m,{get when(){return _().role===2},get children(){return t(Z,{get w(){return l[1].w},get children(){return t(tt,{get name(){return e.creator},get role(){return e.creator_role}})}})}}),t(Z,{get w(){return l[2].w},get children(){return t(rt,{get state(){return e.state}})}}),t(We,{get w(){return l[3].w},trackColor:"$info3",rounded:"$full",size:"sm",get value(){return e.progress},mr:"$1",get children(){return t(je,{color:"$info8",rounded:"$md"})}}),t(Z,{get w(){return l[1].w},get children(){return t(L,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:I})}}),t($e,{get w(){return l[5].w},gap:"$1",get children(){return[t(ye,{}),t(m,{get when(){return e.canRetry},get children(){return t(y,{size:"sm",disabled:!i,display:i?"block":"none",get loading(){return v()},onClick:async()=>{const c=await x();A(c,()=>{te.info(n("tasks.retry")),g(!0)})},get children(){return n("tasks.retry")}})}}),t(y,{size:"sm",colorScheme:"danger",get loading(){return d()},onClick:async()=>{const c=await u();A(c,()=>{te.success(n("global.delete_success")),g(!0)})},get children(){return n(`global.${s}`)}}),t(y,{size:"sm",colorScheme:"neutral",onClick:()=>{e.setLocal({selected:e.local.selected,expanded:!e.local.expanded})},get children(){return re(()=>!!e.local.expanded,!0)()?n("tasks.fold"):n("tasks.expand")}})]}})]}}),t(m,{get when(){return e.local.expanded},get children(){return t(G,{css:{wordBreak:"break-all",fontSize:"0.8em"},w:"$full",pl:"$2",pr:"$2",get children(){return[t(Ue,{templateColumns:"min-content 1fr",w:"$full",columnGap:"$4",mb:"$2",get children(){return[t(m,{when:h!==-1,get children(){return[t(F,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return n("tasks.attr.time_elapsed")}}),t(F,{color:"$neutral9",get children(){return nt(j-h)}})]}}),t(m,{when:k!==null,get children(){return t(xe,{get each(){return Object.entries(e.nameAnalyzer.attrs)},children:c=>{const w=c[1](k);return w===void 0?null:t(m,{get when(){return c[1]!==void 0},get children(){return[t(F,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return c[0]}}),t(F,{color:"$neutral9",children:w})]}})}})}}),t(F,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return n("tasks.attr.status")}}),t(F,{color:"$neutral9",get children(){return e.status}}),t(m,{get when(){return e.error},get children(){return[t(F,{color:"$danger9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return n("tasks.attr.err")}}),t(F,{color:"$danger9",get children(){return e.error}})]}})]}}),t(Ve,{})]}})}})]}})},lt=e=>{const n=z(),[s,i]=S(()=>b.get(`/task/${e.type}/${e.done}`)),[d,u]=f([]),[v,x]=f("name"),[B,g]=f(!1),k={name:(r,a)=>r.name>a.name?1:-1,creator:(r,a)=>r.creator===a.creator?r.id>a.id?1:-1:r.creator>a.creator?1:-1,state:(r,a)=>r.state===a.state?r.id>a.id?1:-1:r.state>a.state?1:-1,progress:(r,a)=>r.progress===a.progress?r.id>a.id?1:-1:r.progress<a.progress?1:-1},K=R(()=>(r,a)=>(B()?-1:1)*k[v()](r,a)),h=async()=>{const r=await i();A(r,a=>{var fe;const $=new Date().getTime(),ge={},ue={},X={},he={},me={};for(const o of d())ge[o.id]=o.curFetchTime,ue[o.id]=o.prevFetchTime,X[o.id]=o.progress,he[o.id]=o.prevProgress,me[o.id]=o.local;u((fe=a==null?void 0:a.map(o=>{var we;let J,Y;o.progress===X[o.id]?(J=ue[o.id],Y=he[o.id]):(J=ge[o.id],Y=X[o.id]);const Ge=(we=me[o.id])!=null?we:{selected:!1,expanded:!1};return{...o,curFetchTime:$,prevFetchTime:J,prevProgress:Y,local:Ge}}).sort(K()))!=null?fe:[])})};if(h(),e.done==="undone"){const r=setInterval(h,2e3);He(()=>clearInterval(r))}const[j,I]=S(()=>b.post(`/task/${e.type}/clear_done`)),[U,c]=S(()=>b.post(`/task/${e.type}/clear_succeeded`)),[w,p]=S(()=>b.post(`/task/${e.type}/retry_failed`)),[P,Ce]=f(""),[Fe,Se]=f(new RegExp("")),[be,ae]=f(!1);Ke(()=>{try{Se(new RegExp(P())),ae(!1)}catch{ae(!0)}});const[le,Ae]=f(_().role!==2),q=R(()=>{const r=Fe(),a=le();return $=>r.test($.name)&&(!a||$.creator===_().username)}),C=R(()=>d().filter(q())),se=R(()=>C().map(r=>r.local.selected).every(Boolean)),ze=R(()=>C().map(r=>r.local.selected).some(Boolean)&&!se()),Pe=r=>u(d().map(a=>(q()(a)&&(a.local.selected=r),a))),ce=R(()=>C().map(r=>r.local.expanded).every(Boolean)),Re=r=>u(d().map(a=>(q()(a)&&(a.local.expanded=r),a))),oe=()=>C().filter(r=>r.local.selected).map(r=>r.id),[De,Le]=S(()=>b.post(`/task/${e.type}/retry_some`,oe())),[Te,Be]=S(()=>b.post(`/task/${e.type}/${de}_some`,oe())),ie=r=>{Object.entries(r).forEach(([a,$])=>{te.error(`${a}: ${$}`)})},[Ne,Oe]=f(1),Q=20,de=e.done==="undone"?"cancel":"delete",Ie=R(()=>{const r=(Ne()-1)*Q,a=r+Q;return C().slice(r,a)}),N=r=>({fontWeight:"bold",fontSize:"$sm",color:"$neutral11",textAlign:r.textAlign}),V=r=>({cursor:"pointer",onClick:()=>{v()===r.name?g(!B()):Qe(()=>{x(r.name),g(!1)}),h()}}),Me=r=>a=>u(d().map($=>($.id===r&&($.local=a),$)));return t(G,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[t(ne,{size:"lg",get children(){return n(`tasks.${e.done}`)}}),t(M,{gap:"$2",flexWrap:"wrap",get children(){return[t(m,{get when(){return e.done==="done"},get children(){return[t(y,{colorScheme:"accent",get loading(){return s()},onClick:h,get children(){return n("global.refresh")}}),t(y,{get loading(){return w()},onClick:async()=>{const r=await p();A(r,()=>h())},get children(){return n("tasks.retry_failed")}}),t(y,{colorScheme:"danger",get loading(){return j()},onClick:async()=>{const r=await I();A(r,()=>h())},get children(){return n("global.clear")}}),t(y,{colorScheme:"success",get loading(){return U()},onClick:async()=>{const r=await c();A(r,()=>h())},get children(){return n("tasks.clear_succeeded")}})]}}),t(m,{get when(){return e.canRetry},get children(){return t(y,{colorScheme:"primary",get loading(){return De()},onClick:async()=>{const r=await Le();A(r,a=>{ie(a),h()})},get children(){return n("tasks.retry_selected")}})}}),t(y,{colorScheme:"warning",get loading(){return Te()},onClick:async()=>{const r=await Be();A(r,a=>{ie(a),h()})},get children(){return n(`tasks.${de}_selected`)}}),t(qe,{width:"auto",get placeholder(){return n("tasks.filter")},get value(){return P()},onInput:r=>Ce(r.target.value),get invalid(){return be()}}),t(m,{get when(){return _().role===2},get children(){return t(ee,{get checked(){return le()},onChange:r=>Ae(r.target.checked),get children(){return n("tasks.show_only_mine")}})}})]}}),t(G,{w:{"@initial":"1024px","@lg":"$full"},overflowX:"auto",shadow:"$md",rounded:"$lg",spacing:"$1",p:"$1",get children(){return[t(M,{class:"title",w:"$full",p:"$2",get children(){return[t(M,{get w(){return l[0].w},spacing:"$1",get children(){return[t(ee,{get disabled(){return C().length===0},get checked(){return se()},get indeterminate(){return ze()},onChange:r=>Pe(r.target.checked)}),t(L,D(()=>N(l[0]),()=>V(l[0]),{get children(){return n(`tasks.attr.${l[0].name}`)}}))]}}),t(m,{get when(){return _().role===2},get children(){return t(L,D({get w(){return l[1].w}},()=>N(l[1]),()=>V(l[1]),{get children(){return n(`tasks.attr.${l[1].name}`)}}))}}),t(L,D({get w(){return l[2].w}},()=>N(l[2]),()=>V(l[2]),{get children(){return n(`tasks.attr.${l[2].name}`)}})),t(L,D({get w(){return l[3].w}},()=>N(l[3]),()=>V(l[3]),{get children(){return n(`tasks.attr.${l[3].name}`)}})),t(L,D({get w(){return l[4].w}},()=>N(l[4]),{get children(){return n(`tasks.attr.${l[4].name}`)}})),t($e,{get w(){return l[5].w},gap:"$2",get children(){return[t(ye,{}),t(L,D(()=>N(l[5]),{get children(){return n(`tasks.attr.${l[5].name}`)}})),t(y,{size:"xs",colorScheme:"neutral",onClick:()=>Re(!ce()),get disabled(){return C().length===0},get children(){return re(()=>!!ce(),!0)()?n("tasks.fold_all"):n("tasks.expand_all")}})]}})]}}),re(()=>Ie().map(r=>t(at,D(r,e,{get setLocal(){return Me(r.id)}}))))]}}),t(Ee,{get total(){return C().length},defaultPageSize:Q,onChange:r=>{Oe(r)}})]}})},it=e=>{const n=z();return t(G,{w:"$full",alignItems:"start",spacing:"$4",get children(){return[t(ne,{size:"xl",get children(){return n(`tasks.${e.type}`)}}),t(G,{w:"$full",spacing:"$2",get children(){return t(xe,{each:["undone","done"],children:s=>t(lt,{get type(){return e.type},done:s,get canRetry(){return e.canRetry},get nameAnalyzer(){return e.nameAnalyzer}})})}})]}})},H=ve("<p></p>"),st=ve('<a target="_blank"></a>'),O=(e,n,s=!0)=>{const i=(e==="/"?"":e)+n,d=_().base_path==="/"?"":_().base_path,u=i.startsWith(d),[v,x]=f(!1),{to:B}=Je();return u&&s?(()=>{const g=H.cloneNode(!0);return g.$$mouseout=()=>x(!1),g.$$mouseover=()=>x(!0),g.addEventListener("click",k=>{B(Ye(i.slice(d.length)))}),W(g,i),pe(k=>_e(g,v()?"text-decoration: underline":"",k)),g})():(()=>{const g=H.cloneNode(!0);return W(g,i),g})()},dt=()=>{const e=z(),[n,s]=f(!1);return{regex:/^download (.+) to \((.+)\)$/,title:i=>i[1],attrs:{[e("tasks.attr.offline_download.url")]:i=>(()=>{const d=st.cloneNode(!0);return d.$$mouseout=()=>s(!1),d.$$mouseover=()=>s(!0),W(d,()=>i[1]),pe(u=>{const v=n()?"text-decoration: underline":"",x=i[1];return u._v$=_e(d,v,u._v$),x!==u._v$2&&Ze(d,"href",u._v$2=x),u},{_v$:void 0,_v$2:void 0}),d})(),[e("tasks.attr.offline_download.path")]:i=>O("",i[2])}}},gt=()=>{const e=z();return{regex:/^transfer \[(.*)]\((.*\/([^\/]+))\) to \[(.+)]\((.+)\)$/,title:n=>n[3],attrs:{[e("tasks.attr.offline_download.transfer_src")]:n=>n[1]===""?void 0:O(n[1],n[2]),[e("tasks.attr.offline_download.transfer_src_local")]:n=>n[1]===""?n[2]:void 0,[e("tasks.attr.offline_download.transfer_dst")]:n=>O(n[4],n[5])}}},ut=()=>{const e=z();return{regex:/^decompress \[(.+)]\((.*\/([^\/]+))\)\[(.+)] to \[(.+)]\((.+)\) with password <(.*)>$/,title:n=>n[3],attrs:{[e("tasks.attr.decompress.src")]:n=>O(n[1],n[2]),[e("tasks.attr.decompress.dst")]:n=>O(n[5],n[6]),[e("tasks.attr.decompress.inner")]:n=>(()=>{const s=H.cloneNode(!0);return W(s,()=>n[4]),s})(),[e("tasks.attr.decompress.password")]:n=>(()=>{const s=H.cloneNode(!0);return W(s,()=>n[7]),s})()}}},ht=()=>{const e=z();return{regex:/^upload (.+) to \[(.+)]\((.+)\)$/,title:n=>n[1],attrs:{[e("tasks.attr.decompress.dst")]:n=>O(n[2],n[3])}}};Xe(["mouseover","mouseout"]);export{it as T,gt as a,O as b,ut as c,ht as d,dt as g};
