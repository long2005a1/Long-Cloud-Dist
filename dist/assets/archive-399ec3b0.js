import{b as Z,d as le,b9 as J,dS as ce,dT as de,C as ue,D as d,K as ge,x as e,a6 as he,a0 as K,a1 as N,Z as V,a5 as fe,ad as me,ae as P,ag as we,S as G,aj as h,ao as be,ar as pe,ak as H,$ as xe,d9 as ke,aI as A,a2 as _e,I as Q,az as $e,cn as Ce,cA as ye,aw as je,d5 as ve,q as Se,aW as Me,aJ as Pe,aK as Ie,aN as Le,_ as I,G as f,dU as Oe,o as ze,aV as Ae}from"./index-ff851c3c.js";import{L as Be,c as m}from"./List-2ea1927e.js";import{a as Ee,d as qe}from"./index-dd9c6a04.js";import Te from"./Password-7bd64468.js";import{u as Fe}from"./helper-39d46e85.js";import{g as Ue}from"./icon-dbba26bd.js";import{x as L,w as De,b as Re}from"./style-9cd7a53f.js";import"./index-8c39f611.js";import"./Layout-82475201.js";import"./FolderTree-1a440827.js";import"./index-6ef9ae25.js";import"./index-df9e2690.js";import"./index-110fcbff.js";function We(){let n=!1,i=[];return{acquire:()=>new Promise(a=>{n?i.push(a):(n=!0,a())}),release:()=>{i.length>0?i.shift()():n=!1}}}const X=n=>{window.open(n,"_blank")},Je=n=>{const{show:i}=Re({id:2}),{isMouseSupported:a}=Fe(),u=()=>ze.list_item_filename_overflow;return e(je.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return e(A,{class:"list-item viselect-item",get"data-index"(){return n.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:_e()}},get cursor(){return a()?"default":"pointer"},"on:click":w=>{n.obj.is_dir?n.jumpCallback():n.url&&X(n.url)},onContextMenu:w=>{i(w,{props:n})},get children(){return[e(A,{class:"name-box",spacing:"$1",get w(){return m[0].w},get children(){return[e(Q,{class:"icon",boxSize:"$6",get color(){return $e()},get as(){return Ue(n.obj)},mr:"$1"}),e(h,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:u()==="multi_line"?"unset":"nowrap","overflow-x":u()==="scrollable"?"auto":"hidden",textOverflow:u()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return n.obj.name},get children(){return n.obj.name}})]}}),e(h,{class:"size",get w(){return m[1].w},get textAlign(){return m[1].textAlign},get children(){return Ce(n.obj.size)}}),e(h,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return m[2].w},get textAlign(){return m[2].textAlign},get children(){return ye(n.obj.modified)}})]}})}})},O={extract:{icon:Ee,color:"$success9"},copy_link:{icon:qe,color:"$info9"},download:{icon:Ae,color:"$primary9"}},Ke=()=>{const{copy:n}=ve(),{colorMode:i}=Se();return e(De,{id:2,animation:"scale",get theme(){return i()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[e(L,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{X(a.url)},get children(){return e(z,{name:"download"})}}),e(L,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{n(a.url)},get children(){return e(z,{name:"copy_link"})}}),e(L,{hidden:()=>{const a=Me.findIndex(u=>u==="decompress");return!Pe.can(Ie(),a)},onClick:({props:a})=>{Le.emit("extract",JSON.stringify({inner:a.innerPath,pass:a.pass}))},get children(){return e(z,{name:"extract"})}})]}})},z=n=>{const i=Z();return e(A,{spacing:"$2",get children(){return[e(Q,{get p(){return O[n.name].p?"$1":void 0},get as(){return O[n.name].icon},boxSize:"$7",get color(){return O[n.name].color}}),e(h,{get children(){return i(`home.toolbar.${n.name}`)}})]}})},st=()=>{const n=Z(),{pathname:i}=le(),[a,u]=J(ce),[w,B]=J(de),Y=ue(()=>a()||w());let l="",_="",$="",b=null;const[C,p]=d(""),[ee,E]=d(!1),[y,j]=d(!1),[q,te]=d(""),[c,v]=d([]),[S,T]=d(),[re,F]=d(!1),[ne,U]=d(""),g=We(),x=r=>{let s={};return r.forEach(t=>{s[t.name]={...t,children:t.children?x(t.children):null}}),s},M=r=>r.code===200?!1:(r.code===202?f(()=>{l!==""&&E(!0),j(!0),p("")}):p(r.message),!0),D=async r=>{if(await g.acquire(),y()&&l==="")return g.release(),[];if(_===""){const t=await u(i(),I(),l);if(M(t))return g.release(),[];if(t.data.content!==null&&(b=x(t.data.content)),_=t.data.raw_url,$=t.data.sign,te(t.data.comment),t.data.sort!==void 0){let o;t.data.sort.order_by!==""&&(o=t.data.sort.order_by);let k=t.data.sort.order_direction==="desc",ie=t.data.sort.extract_folder;f(()=>{T(o),F(k),U(ie)})}if(t.data.encrypted&&l==="")return f(()=>{j(!0),p("")}),g.release(),[]}if(b===null){const t=await B(i(),I(),l,"/");if(M(t))return g.release(),[];b=x(t.data.content)}let s=b;for(let t=0;t<r.length;t++){if(s[r[t]].children===null){const o=await B(i(),I(),l,"/"+r.slice(0,t+1).join("/"));if(M(o))return g.release(),[];s[r[t]].children=x(o.data.content)}s=s[r[t]].children}return f(()=>{j(!1),E(!1),p("")}),g.release(),Object.values(s)},[ae,R]=d([]);ge(()=>{D(c()).then(r=>R(r))});const W=()=>{D(c()).then(r=>R(r))};W();const se=()=>{let r=ae();S()&&(r=r.sort((t,o)=>(re()?-1:1)*Oe(t[S()],o[S()])));let s=ne();if(s!==""){let t=[],o=[];r.forEach(k=>(k.is_dir?t:o).push(k)),r=s==="front"?t.concat(o):o.concat(t)}return r},oe=(r,s)=>{f(()=>{U(""),T(r),s!==void 0&&F(s)})};return e(H,{spacing:"$2",w:"$full",get children(){return[e(he,{pl:"$2",pr:"$2",w:"$full",get children(){return[e(K,{get children(){return e(N,{get currentPage(){return c().length===0},"on:click":()=>v([]),children:"."})}}),e(V,{get each(){return c()},children:(r,s)=>e(K,{get children(){return[e(fe,{}),e(N,{get currentPage(){return c().length===s()+1},"on:click":()=>v(c().slice(0,s()+1)),children:r})]}})})]}}),e(me,{get children(){return[e(P,{get when(){return C()!==""},get children(){return e(we,{get msg(){return C()},disableColor:!0})}}),e(P,{get when(){return y()},get children(){return e(Te,{get title(){return n("home.toolbar.archive.input_password")},password:()=>l,setPassword:r=>l=r,enterCallback:()=>W(),get children(){return e(G,{get when(){return ee()},get children(){return e(h,{color:"$danger9",get children(){return n("home.toolbar.archive.incorrect_password")}})}})}})}}),e(P,{get when(){return be(()=>!y(),!0)()&&C()===""},get children(){return e(pe,{get loading(){return Y()},get children(){return e(H,{class:"list",w:"$full",spacing:"$1",get children(){return[e(Be,{sortCallback:oe,disableCheckbox:!0}),e(V,{get each(){return se()},children:(r,s)=>{let t,o=(c().length>0?"/"+c().join("/"):"")+"/"+r.name;return r.is_dir||(t=_+"?inner="+xe(o,!0),l!==""&&(t=t+"&pass="+encodeURIComponent(l)),$!==""&&(t=t+"&sign="+$)),e(Je,{obj:r,get index(){return s()},jumpCallback:()=>v(c().concat(r.name)),innerPath:o,url:t,pass:l})}}),e(Ke,{})]}})}})}})]}}),e(G,{get when(){return q()!==""},get children(){return[e(ke,{}),e(h,{w:"$full",pl:"$1",pr:"$1",get children(){return q()}})]}})]}})};export{st as default};
